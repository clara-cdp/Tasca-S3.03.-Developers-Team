<!--  ******************************** mobile MENU ******************************** -->

<div class="lg:hidden">
    <?php echo $this->render('../components/header.phtml'); ?>


    <nav class="w-full bg-sidebar-teal/95 backdrop-blur-sm sticky top-0 z-50 border-b border-white/10">
        <form action="<?= WEB_ROOT ?>/home" method="GET">
            <div class="max-w-7xl mx-auto px-4 py-1.5 flex items-center justify-between">

                <div class="flex items-center gap-0.5">
                    <button name="date" value="old"
                        class="px-2 py-0.5 text-[12px] font-black uppercase tracking-tighter transition-all 
                <?= ($_GET['date'] ?? '') === 'old' ? 'text-white bg-white/20 rounded-md' : 'text-white/40' ?>">Old
                    </button>

                    <button name="date" value="new"
                        class="px-2 py-0.5 text-[12px] font-black uppercase tracking-tighter transition-all 
                <?= ($_GET['date'] ?? '') === 'new' ? 'text-white bg-white/20 rounded-md' : 'text-white/40' ?>">
                        New
                    </button>
                </div>

                <div class="flex items-center gap-3">
                    <button name="status" value="pending"
                        class="text-[12px] font-black uppercase transition-all 
                <?= ($_GET['status'] ?? '') === 'pending' ? 'text-white' : 'text-white/30' ?>">
                        Pnd
                    </button>
                    <button name="status" value="ongoing"
                        class="text-[12px] font-black uppercase transition-all 
                <?= ($_GET['status'] ?? '') === 'ongoing' ? 'text-white' : 'text-white/30' ?>">
                        Ong
                    </button>
                    <button name="status" value="finished"
                        class="text-[12px] font-black uppercase transition-all 
                <?= ($_GET['status'] ?? '') === 'finished' ? 'text-white' : 'text-white/30' ?>">
                        Fin
                    </button>
                </div>

                <div class="flex items-center pl-2 border-l border-white/10">
                    <a href="/web/home" class="text-[10px] font-black text-white/40 hover:text-white transition-colors">
                        RESET
                    </a>
                </div>
            </div>
        </form>
    </nav>
</div>


<!--  ******************************** SIDE MENU ******************************** -->

<div class="flex flex-col lg:flex-row min-h-screen">

    <aside class="hidden lg:flex flex-col w-45 xl:w-60 bg-sidebar-teal/95 text-white p-8 xl:p-12 flex-shrink-0 min-h-screen transition-all duration-300">

        <h3 class="font-black uppercase mb-6 lg:mb-10 text-[10px] lg:text-xs tracking-[0.2em]">Sort By</h3>

        <form action="<?= WEB_ROOT ?>/home" method="GET" class="flex flex-col gap-4 lg:gap-8 text-sm lg:text-[16px] font-semibold uppercase text-white/60">

            <button name="date" value="old"
                class="text-left py-1 px-2 rounded transition-all hover:text-white 
                <?= ($_GET['date'] ?? '') === 'old' ? 'text-white bg-white/10' : '' ?>"> Oldest
            </button>

            <button name="date" value="new"
                class="text-left py-1 px-2 rounded transition-all hover:text-white 
                <?= ($_GET['date'] ?? '') === 'new' ? 'text-white bg-white/10' : '' ?>">Newest
            </button>

            <button name="status" value="pending"
                class="text-left py-1 px-2 rounded transition-all hover:text-white 
                <?= ($_GET['status'] ?? '') === 'pending' ? 'text-white bg-white/10' : '' ?>">Pending
            </button>

            <button name="status" value="ongoing"
                class="text-left py-1 px-2 rounded transition-all hover:text-white 
                <?= ($_GET['status'] ?? '') === 'ongoing' ? 'text-white bg-white/10' : '' ?>">Ongoing
            </button>

            <button name="status" value="finished"
                class="text-left py-1 px-2 rounded transition-all hover:text-white 
                <?= ($_GET['status'] ?? '') === 'finished' ? 'text-white bg-white/10' : '' ?>">Finished
            </button>

            <div class="mt-auto pt-10">
                <a href="/web/home" class="w-fit opacity-40 hover:opacity-100 transition-opacity">Reset Filters</a>
            </div>
        </form>
    </aside>

    <!--  ******************************** SEARCH AND ADD BUTTONS ******************************** -->

    <main class="flex-grow w-full">
        <div class="hidden lg:block">
            <?php echo $this->render('../components/header.phtml'); ?>
        </div>

        <div class="w-full max-w-6xl flex flex-col md:flex-row justify-between items-center gap-6 mt-6 mb-10 lg:mb-16 px-6 mx-auto">

            <div class="w-full md:w-auto flex-grow max-w-md">
                <form action="home" method="POST" class="w-full">
                    <input type="text"
                        name="keyWord"
                        placeholder="ðŸ” search"
                        class="w-full rounded-full px-6 lg:px-8 py-3 bg-white shadow-xl outline-teal focus:ring-2 focus:ring-teal-400 text-sm text-slate-800">
                </form>
            </div>

            <div class="w-full md:w-auto max-w-md mx-auto md:mx-0">
                <a href="<?= WEB_ROOT ?>/create"
                    class="btn-main block md:inline-block text-center bg-teal-400 text-sm lg:text-base text-teal-900 px-6 
                    lg:px-10 py-3 lg:py-4 rounded-2xl shadow-2xl transition-transform hover:scale-105 active:scale-95">
                    + Add New
                </a>
            </div>
        </div>

        <!--  ******************************** TASK VIWER ******************************** -->

        <div class="w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-6 lg:gap-12 px-6 mx-auto ">
            <?php
            $displayTasks = $this->view->tasks ?? $this->tasks ?? [];
            if (!empty($displayTasks)):
                foreach ($displayTasks as $task): ?>

                    <div class="card-white group flex flex-col h-full overflow-hidden">

                        <!-- ribbon ------------------------------------------------------>
                        <?php
                        $ribbonColor = 'bg-red-800';
                        if (($task['task_state'] ?? '') == 'ongoing') $ribbonColor = 'bg-teal-900';
                        if (($task['task_state'] ?? '') == 'finished') $ribbonColor = 'bg-teal-100';
                        ?>
                        <div class="absolute top-0 right-12 w-10 h-16 <?= $ribbonColor ?> ribbon shadow-lg"></div>

                        <!-- task details ------------------------------------------------------>
                        <div class="flex-grow">
                            <h3 class="text-base font-black  mb-4 uppercase text-slate-800 tracking-wide">
                                <?= htmlspecialchars($task['task_title'] ?? 'Task') ?>
                            </h3>
                            <p class="text-gray-500 text-base leading-2 mb-4 min-h-[70px] line-clamp-3">
                                <?= htmlspecialchars($task['task_description'] ?? '') ?>
                            </p>

                            <p class="text-[10px] text-gray-400 font-semibold uppercase italic tracking-widest">created by:
                                <?= htmlspecialchars($task['user_name'] ?? '') ?>
                            </p>

                            <div class="space-y-1 mb-3 ">
                                <p class="text-[10px] text-gray-400 font-semibold uppercase italic tracking-widest">on
                                    <?= htmlspecialchars($task['created_at'] ?? '') ?>
                                </p>
                                <?php if (!empty($task['finished_at'])): ?>
                                    <p class="text-[12px] text-teal-600 font-black uppercase tracking-widest mt-2">
                                        Finished: <?= htmlspecialchars($task['finished_at']) ?>
                                    </p>
                                <?php endif; ?>
                            </div>

                            <!--- START/FINISH TASK BUTTONS  --------------------------------------------------------------------------->
                            <div class="flex ">
                                <?php if (($task['task_state'] ?? '') == 'pending'): ?>
                                    <a href=" changetask_state?id=<?= $task['idTASK'] ?>&task_state=ongoing"
                                        class="btn-main w-full block text-center bg-teal-500">Start Task</a>

                                <?php elseif (($task['task_state'] ?? '') == 'ongoing'): ?>
                                    <a href="changetask_state?id=<?= $task['idTASK'] ?>&task_state=finished"
                                        class="btn-main w-full block text-center bg-teal-800">Mark as Done</a>

                                <?php endif; ?>
                            </div>
                        </div>

                        <!---- EDIT AND DELETE BUTTONS -->

                        <div class="opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 
                                        group-hover:translate-y-0 flex gap-4 ">
                            <a href="update?id=<?= $task['idTASK'] ?>"
                                class="btn-main flex-1 text-center bg-teal-200 !text-teal-500 hover:!bg-teal-900 hover:!text-white">Edit</a>
                            <a href=" delete?idTASK=<?= $task['idTASK'] ?>"
                                onclick="return confirm('Are you sure you want to delete this task?')"
                                class=" btn-main flex-1 text-center bg-red-500/20 !text-red-500 hover:!bg-red-500 hover:!text-white">Delete</a>
                        </div>
                    </div>



            <?php endforeach;
            endif; ?>
        </div>
        <div class="mt-auto">
            <?php echo $this->render('../components/footer.phtml'); ?>
        </div>
    </main>
</div>